# Security Middleware Configuration
# Copy these variables to your .env file and adjust as needed

# ============================================================================
# CORE SECURITY SETTINGS
# ============================================================================

# Enable/disable security middleware globally
SECURITY_MIDDLEWARE_ENABLED=true

# Emergency kill switch (set to true to bypass all security checks)
SECURITY_KILL_SWITCH=false

# Maximum request size (bytes) - 10MB default
SECURITY_MAX_REQUEST_SIZE=10485760

# ============================================================================
# RATE LIMITING CONFIGURATION
# ============================================================================

# Global rate limits (requests per minute)
SECURITY_RATE_LIMIT_GLOBAL=1000
SECURITY_RATE_LIMIT_IP=60
SECURITY_RATE_LIMIT_USER=120
SECURITY_RATE_LIMIT_ROUTE=200
SECURITY_RATE_LIMIT_BURST=20

# Route-specific rate limits
SECURITY_RATE_LIMIT_LOGIN=5
SECURITY_RATE_LIMIT_API=100
SECURITY_RATE_LIMIT_ADMIN=30

# ============================================================================
# WEB APPLICATION FIREWALL (WAF)
# ============================================================================

# Enable WAF protection
SECURITY_WAF_ENABLED=true

# Sampling rate for WAF checks (0.0 to 1.0)
# 0.1 = check 10% of requests for performance
SECURITY_WAF_SAMPLING_RATE=0.1

# Deep analysis sampling (expensive checks)
SECURITY_WAF_DEEP_SAMPLING=0.01

# Maximum content size to scan (bytes) - 64KB default
SECURITY_WAF_MAX_SCAN_SIZE=65536

# WAF Rule Sets
SECURITY_WAF_SQLI_ENABLED=true
SECURITY_WAF_XSS_ENABLED=true
SECURITY_WAF_LFI_ENABLED=true
SECURITY_WAF_RCE_ENABLED=true

# ============================================================================
# INPUT VALIDATION
# ============================================================================

# Maximum input field length
SECURITY_MAX_INPUT_LENGTH=4096

# Maximum file upload size (bytes) - 5MB default
SECURITY_MAX_FILE_SIZE=5242880

# ============================================================================
# BRUTE FORCE PROTECTION
# ============================================================================

# Enable brute force protection
SECURITY_BRUTE_FORCE_ENABLED=true

# Maximum login attempts before lockout
SECURITY_BRUTE_FORCE_MAX_ATTEMPTS=5

# Lockout duration (seconds) - 15 minutes default
SECURITY_BRUTE_FORCE_LOCKOUT=900

# Progressive delay between attempts
SECURITY_BRUTE_FORCE_DELAY=true

# CAPTCHA trigger threshold
SECURITY_BRUTE_FORCE_CAPTCHA=3

# ============================================================================
# SECURITY HEADERS
# ============================================================================

# HTTP Strict Transport Security
SECURITY_HSTS_ENABLED=true
SECURITY_HSTS_MAX_AGE=31536000
SECURITY_HSTS_SUBDOMAINS=true

# Content Security Policy
SECURITY_CSP_ENABLED=true
SECURITY_CSP_POLICY="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"

# Other security headers
SECURITY_FRAME_OPTIONS=DENY
SECURITY_CONTENT_TYPE_OPTIONS=nosniff
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin

# ============================================================================
# LOGGING AND MONITORING
# ============================================================================

# Enable security event logging
SECURITY_LOGGING_ENABLED=true

# Sampling rate for logs (0.0 to 1.0) to prevent log bloat
SECURITY_LOGGING_SAMPLE_RATE=0.1

# Log channel for security events
SECURITY_LOG_CHANNEL=daily

# Send logging to background queue
SECURITY_LOGGING_BACKGROUND=true

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Individual feature toggles
SECURITY_FEATURE_RATE_LIMITING=true
SECURITY_FEATURE_WAF=true
SECURITY_FEATURE_BRUTE_FORCE=true
SECURITY_FEATURE_FILE_SCAN=true
SECURITY_FEATURE_DEEP_ANALYSIS=false
SECURITY_FEATURE_THREAT_INTEL=false

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Maximum allowed middleware latency (milliseconds)
SECURITY_MAX_LATENCY=10

# Cache TTL for security config (seconds)
SECURITY_CACHE_TTL=300

# Redis timeout for security operations (seconds)
SECURITY_REDIS_TIMEOUT=2

# Background queue name for security jobs
SECURITY_BACKGROUND_QUEUE=security

# ============================================================================
# WHITELIST CONFIGURATION
# ============================================================================

# Allowed hosts (comma-separated)
SECURITY_ALLOWED_HOSTS="localhost,127.0.0.1,example.com"

# Allowed IPs for admin bypass (comma-separated)
SECURITY_ALLOWED_IPS=""

# Trusted User-Agents (comma-separated)
SECURITY_ALLOWED_USER_AGENTS=""

# Admin bypass IPs (comma-separated)
SECURITY_ADMIN_BYPASS_IPS=""

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================

# Redis connection for rate limiting and counters
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379
REDIS_DB_SECURITY=1

# ============================================================================
# PRODUCTION RECOMMENDATIONS
# ============================================================================

# For production environments, consider these settings:
# SECURITY_WAF_SAMPLING_RATE=0.05          # Lower sampling for better performance
# SECURITY_LOGGING_SAMPLE_RATE=0.05        # Reduce log volume
# SECURITY_FEATURE_DEEP_ANALYSIS=true      # Enable advanced threat detection
# SECURITY_RATE_LIMIT_IP=30                # Stricter rate limits
# SECURITY_BRUTE_FORCE_MAX_ATTEMPTS=3      # Lower threshold for lockout

# ============================================================================
# DEVELOPMENT RECOMMENDATIONS
# ============================================================================

# For development environments:
# SECURITY_MIDDLEWARE_ENABLED=false        # Disable if causing issues
# SECURITY_WAF_SAMPLING_RATE=1.0           # Check all requests for testing
# SECURITY_LOGGING_SAMPLE_RATE=1.0         # Full logging for debugging
# SECURITY_RATE_LIMIT_IP=1000              # Higher limits for testing
